# Sota.N プロフィールサイト - 技術設計書

---

## 技術スタック

| 技術 | バージョン | 役割 |
|------|-----------|------|
| Next.js | 16.1.6 | フレームワーク（App Router、Turbopack） |
| TypeScript | — | 型安全な開発 |
| Tailwind CSS | v4 | スタイリング（@theme inline） |
| Framer Motion | — | アニメーション（whileInView、useScroll） |
| react-hook-form | — | フォーム状態管理 |
| zod | v4 | フォームバリデーション |
| @hookform/resolvers | — | react-hook-form ↔ zod の連携 |

---

## セットアップ手順

```bash
# 1. プロジェクト作成
#    注意: ディレクトリ名に大文字があると npm のパッケージ名チェックで失敗する。
#    CI=true で対話プロンプトをスキップする。
CI=true npx create-next-app@latest my-profile-site --typescript --tailwind --app

# 2. 追加パッケージインストール
cd my-profile-site
npm install framer-motion react-hook-form zod @hookform/resolvers

# 3. 開発サーバー起動
npm run dev
# → http://localhost:3000

# 4. ビルド
npm run build
```

**注意点**:
- `Noto_Serif_JP` のsubsetsは `["latin"]` のみ指定可能。`["japanese"]` はパッケージに含まれず型エラーになる。
- `/tmp` から移動した場合は `node_modules` のシンボリンク が壊れるため、`rm -rf node_modules && npm install` で再インストールが必要。

---

## プロジェクト構成

```
src/
├── app/
│   ├── layout.tsx              # ルートレイアウト（フォント読み込み、Header/Footer）
│   ├── page.tsx                # Home ページ
│   ├── globals.css             # Tailwind v4 テーマ定義
│   ├── about/
│   │   └── page.tsx            # About ページ
│   ├── journey/
│   │   └── page.tsx            # Journey ページ
│   ├── projects/
│   │   └── page.tsx            # Projects ページ
│   ├── contents/
│   │   └── page.tsx            # Contents ページ
│   └── contact/
│       └── page.tsx            # Contact ページ
├── components/
│   ├── Header.tsx              # "use client" — 固定ヘッダー
│   ├── Footer.tsx              # サーバーコンポーネント — フッター
│   ├── FadeIn.tsx              # "use client" — スクロール連動フェードイン
│   ├── HeroSection.tsx         # "use client" — Home ヒーロー（パララックス）
│   ├── TimelineSection.tsx     # "use client" — Journey タイムライン（インタラクティブ）
│   └── ContactForm.tsx         # "use client" — お問い合わせフォーム
└── lib/
    ├── types.ts                # TypeScript インターフェース
    └── constants.ts            # 全コンテンツデータ

public/
├── profile.jpeg                # プロフィール画像
├── garden.png                  # 庭園画像（ヒーロー背景）
└── blog-logo.png               # 人コマブログロゴ
```

---

## globals.css

Tailwind CSS v4 では `tailwind.config.js` を使わず、`globals.css` の `@theme inline` でカラーやフォントを定義する。

```css
@import "tailwindcss";

@theme inline {
  --color-deep-black: #1a1a1a;
  --color-charcoal: #2d2d2d;
  --color-gold: #c9a961;
  --color-off-white: #f5f5f0;
  --color-beige: #ede8df;
  --color-moss: #5a6b4a;
  --color-stone: #8a8580;
  --font-sans: var(--font-noto-serif-jp), "Hiragino Kaku Gothic Pro", sans-serif;
}

html {
  scroll-behavior: smooth;
}

body {
  background-color: #f5f5f0;
  color: #1a1a1a;
  font-family: var(--font-sans);
}
```

これにより `bg-deep-black`、`text-gold`、`bg-moss/15`（不透明度修飾も可）などのユーティリティクラスが自動で生成される。

---

## types.ts

```typescript
export interface Value {
  emoji: string;
  title: string;
  description: string;
}

export interface Motto {
  text: string;
}

export interface TimelineEvent {
  year: string;
  title: string;
  description: string;
}

export interface Skill {
  category: string;
  items: string[];
}

export interface Project {
  id: string;
  title: string;
  description: string;
  status: "ongoing" | "completed" | "planning";
  tags: string[];
}

export interface SocialLink {
  name: string;
  url: string;
  icon: string;
}

export interface ContentItem {
  title: string;
  description: string;
  url: string;
  icon: string;
}

export interface WabisabiValue {
  title: string;
  description: string;
}
```

---

## constants.ts

すべてのコンテンツデータはここに定義する。実際のデータ値は`00_要件定義書.md`の「コンテンツデータ」セクションを参照。

エクスポートする定数:

| 定数名 | 型 | 内容 |
|--------|-----|------|
| PROFILE | オブジェクト | name, nameJa, tagline, bio, birthYear, location, disability |
| VALUES | Value[] | 3件 |
| MOTTOS | Motto[] | 2件 |
| DREAM | オブジェクト | title, vision, goal |
| WABISABI_PROJECT | オブジェクト | name, tagline, mission, vision, values(WabisabiValue[]), principles(string[]) |
| TIMELINE | TimelineEvent[] | 11件 |
| SKILLS | Skill[] | 5件 |
| PROJECTS | Project[] | 6件 |
| CONTENTS | ContentItem[] | 3件 |
| SOCIAL_LINKS | SocialLink[] | 5件 |
| NAV_ITEMS | オブジェクト[] | label + href の6件 |

---

## コンポーネント実装仕様

### layout.tsx

- `Noto_Serif_JP` を `next/font/google` でインポート。subsets: `["latin"]`。
- `<body>` に `className={inter.className}` で適用。
- `<Header />` と `<Footer />` で `{children}` を囲む。

---

### Header.tsx（"use client"）

```
状態:
  isScrolled: boolean    — window.scrollY > 50 で切り替え
  isMobileMenuOpen: boolean — モバイルメニュー開閉

動作:
  - useEffect で scroll イベントリスナーを設定
  - usePathname() で現在ページを判定し、アクティブナビを金色で強調
  - モバイルハンバーガー: 3本線の div を rotate/translate で X に変換

レイアウト:
  - fixed top-0 w-full z-50
  - スクロール前: bg-transparent
  - スクロール後: bg-deep-black/90 backdrop-blur-sm
  - transition-all duration-300
```

---

### Footer.tsx（サーバーコンポーネント）

- SOCIAL_LINKS を map で描画。
- 各アイコンは SVG で直書き（x, instagram, note, youtube, blog の5種類）。
- コピーライト表示。

---

### FadeIn.tsx（"use client"）

```
Props:
  children: React.ReactNode
  delay?: number          (デフォルト: 0)
  className?: string      (デフォルト: "")
  direction?: "up" | "none"  (デフォルト: "up")
  scale?: boolean         (デフォルト: false)

実装:
  <motion.div
    initial={{ opacity: 0, y: direction === "up" ? 24 : 0, scale: scale ? 0.95 : 1 }}
    whileInView={{ opacity: 1, y: 0, scale: 1 }}
    viewport={{ once: true }}
    transition={{ duration: 0.7, delay, ease: [0.22, 1, 0.36, 1] }}
    className={className}
  >
```

- `viewport.margin` は未設定（`-50px` だと要素がViewport内に充分入る前に発火しず、表示されないバグになる）。
- `scale` プロパティは Projects ページのカード出現で使用（「積み上がる」演出）。

---

### HeroSection.tsx（"use client"）

```
スクロール連動（useScroll + useTransform）:
  scrollY [0, 800]  → imgScale:         1    → 1.2
  scrollY [0, 350]  → contentOpacity:   1    → 0
  scrollY [0, 350]  → contentY:         0    → -30
  scrollY [0, 200]  → indicatorOpacity: 1    → 0

レイアウト（絶対配置のスタック）:
  1. motion.div (scale: imgScale)
       └── <Image src="/garden.png" fill sizes="100vw" priority />
  2. div.absolute.inset-0.bg-deep-black/55          ← オーバーレイ
  3. div.absolute.bottom-0.h-48                     ← from-off-whiteへのグラデーション
  4. motion.div (opacity, y) .relative.z-10         ← テキスト
       └── Welcome / キャッチコピー(グラデーション) / bio
  5. motion.div (opacity) .absolute.bottom-10.z-10  ← スクロールインジケーター
```

---

### TimelineSection.tsx（"use client"）

```
Props:
  events: TimelineEvent[]

状態:
  activeIndex: number | null
  isTouchRef: useRef<boolean>  — タッチ vs マウスを分離検知

イベント処理:
  onPointerDown → isTouchRef.current = (pointerType === "touch")
  onMouseEnter  → if (!isTouchRef) setActiveIndex(i)
  onMouseLeave  → if (!isTouchRef) setActiveIndex(null)
  onClick       → if (isTouchRef)  toggle activeIndex

レイアウト（各イベント）:
  外側 div: flex, 偶数行は flex-row、奇数行は flex-row-reverse
  ├── Content div (md:w-5/12)
  │   ├── 年次 (gold)
  │   ├── タイトル (activeIndex===i ? gold : deep-black)
  │   └── モバイル展開 div (max-h アニメーション)
  ├── Dot div (absolute, center)  — activeIndex===i で scale-125
  └── Popup div (md:w-5/12)
      └── AnimatePresence > motion.div (bg-deep-black, shadow-lg)
```

---

### ContactForm.tsx（"use client"）

```
バリデーションスキーマ (zod):
  name:    z.string().min(1)
  email:   z.string().min(1).regex(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)
  subject: z.string().min(1)
  message: z.string().min(10)

注意: zod v4 では .email() のAPI が変わったため、regex で実装。

状態:
  submitted: boolean — 送信完了後に確認画面へ切り替え

TODO: Formspree連携（現在は console.log のみ）
```

---

## ページ実装の要点

### page.tsx（Home）

- `<HeroSection />` をインポートで庭園ヒーローを表示。
- **Mottos セクション**: `relative overflow-hidden` にし、石の円を `absolute` で2つ配置。コンテンツは `relative z-10` で前に来る。
- **Dream セクション**: 同様に苴緑グロウ div を `absolute bottom-0` で配置。

### about/page.tsx

- Story は6つの `<p>` で構成。各ターニングポイントで改行。
- Wabisabi セクション: Dream と同じ苴緑グロウ実装。

### journey/page.tsx

- `<TimelineSection events={TIMELINE} />` をインポートで表示。

### projects/page.tsx

- カード FadeIn に `scale` プロパティを追加（スケールアップ演出）。
- `STATUS_STYLES` オブジェクトでステータスをラベル＋クラスにマッピング。

### contents/page.tsx

- FadeIn の className に `h-full` を追加。
- Link に `h-full flex flex-col` を追加。
- 「外部リンク →」は `mt-auto pt-4` で下端に揃え。
- アイコン: `content.icon === "blog"` で条件分岐。

---

## 庭園テーマの実装パターン

### 苴緑グロウ（Dream / Wabisabi セクション）

```jsx
<section className="relative py-24 px-6 bg-deep-black text-off-white overflow-hidden">
  <div className="absolute bottom-0 left-1/2 -translate-x-1/2 w-[600px] h-[300px] bg-moss/15 blur-3xl rounded-full" />
  <div className="... relative z-10">
    {/* コンテンツ */}
  </div>
</section>
```

### 石装飾（Mottos セクション）

```jsx
<section className="relative py-24 px-6 bg-off-white overflow-hidden">
  <div className="absolute top-12 right-8 w-40 h-40 rounded-full bg-stone/8 blur-sm" />
  <div className="absolute bottom-8 left-12 w-28 h-28 rounded-full bg-stone/6 blur-sm" />
  <div className="... relative z-10">
    {/* コンテンツ */}
  </div>
</section>
```

共通パターン: セクションに `relative overflow-hidden` を追加し、装飾要素を `absolute` で配置。コンテンツ側に `relative z-10` を追加で前に来る。

---

## よくある問題と対策

| 問題 | 原因 | 対策 |
|------|------|------|
| コンテンツが表示されない | FadeIn の viewport margin が負の値で発火しない | viewport に margin を設定しない（`{ once: true }` のみ） |
| カードの高さが揃わない | グリッド内の FadeIn が h-full を持たない | FadeIn に `className="h-full"`、Link に `h-full flex flex-col` |
| プロフィール画像の顔が見切れる | object-cover がセンターで切る | `object-top` を追加 |
| Noto_Serif_JP のsubsets エラー | `japanese` がパッケージに含まれない | `["latin"]` のみ指定 |
| モバイルタップ時アニメーション発火しない | mouseenter と click が干涉 | `pointerType` で入力種別を分離検知 |
| create-next-app が失敗 | ディレクトリ名に大文字がある | 小文字のディレクトリで作成して移動 |

---

**作成日**: 2026-02-01
**最終更新日**: 2026-02-02
**ステータス**: Phase 2（開発）完了
